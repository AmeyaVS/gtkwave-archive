#
# PCCTS makefile for: verilog.g
#
# Created from: genmk verilog.g
#
# PCCTS release 1.33MR23
# Project: t
# C output
# DLG scanner
# ANTLR-defined token types
#
TOKENS = tokens.h
#
# The following filenames must be consistent with ANTLR/DLG flags
DLG_FILE = parser.dlg
ERR = err
HDR_FILE =
MOD_FILE = mode.h
SCAN = scan
PCCTS = ../pccts
ANTLR_H = $(PCCTS)/h
BIN = $(PCCTS)/bin
ANTLR = $(BIN)/antlr
DLG = $(BIN)/dlg
CFLAGS = -O2 -I. -I$(ANTLR_H) $(COTHER)
AFLAGS = -ga -k 2 -gl
DFLAGS = -ga -C2 -i
GRM = verilog.g
SRC = verilog.c $(SCAN).c $(ERR).c inter.c shred.c symbol.c jrb.c preproc.c definehash.c keywordhash.c args.c
OBJ = verilog.o $(SCAN).o $(ERR).o inter.o shred.o symbol.o jrb.o preproc.o definehash.o keywordhash.o args.o

ANTLR_SPAWN = verilog.c $(DLG_FILE) $(TOKENS) $(ERR).c
DLG_SPAWN = $(SCAN).c $(MOD_FILE)

CC=@CC@

all: vertex
	cp vertex ../../bin/vertex

vertex : $(SRC) $(OBJ)
	$(CC) -o vertex $(CFLAGS) $(OBJ) -lm

verilog.o : $(MOD_FILE) $(TOKENS) verilog.c
	$(CC) -c $(CFLAGS) -o verilog.o verilog.c

$(ERR).o : $(ERR).c $(TOKENS)
	$(CC) -c $(CFLAGS) -o $(ERR).o $(ERR).c

$(SCAN).o : $(SCAN).c $(TOKENS)
	$(CC) -c $(CFLAGS) -o $(SCAN).o $(SCAN).c

$(ANTLR_SPAWN) : $(GRM)
	$(ANTLR) $(AFLAGS) $(GRM)

$(DLG_SPAWN) : $(DLG_FILE)
	$(DLG) $(DFLAGS) $(DLG_FILE) $(SCAN).c

clean:
	rm -f *.o core *.core vertex ../../bin/vertex verilog.c scan.c err.c parser.dlg tokens.h mode.h

scrub: clean
	rm -f $(ANTLR_SPAWN) $(DLG_SPAWN)

definehash.c: vpp_keyword.gperf
	gperf -C -I -N is_builtin_define vpp_keyword.gperf >definehash.c

keywordhash.c: verilog_keyword.gperf
	printf "gperf -o -i 1 -C -k 1-3,\044 -L C -H keyword_hash -N check_identifier -tT verilog_keyword.gperf >keywordhash.c" | sh

